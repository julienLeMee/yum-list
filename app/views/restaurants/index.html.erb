<main class="pt-16 pb-28 lg:pl-72">
  <div class="px-4 sm:px-6 lg:px-8">

    <% if @restaurants.any? %>
      <%= form_with(url: restaurants_path, method: :get, local: true, id: "search-form", html: { class: "mt-4" }) do %>
        <div class="relative my-3 flex items-center">
          <svg xmlns="http://www.w3.org/2000/svg" width="16px" height="16px" fill="none" stroke-width="2.5" viewBox="0 0 24 24" class="absolute left-3.5 text-gray-500 pointer-events-none z-10">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" d="M17 17l4 4M3 11a8 8 0 1 0 16 0 8 8 0 0 0-16 0Z"></path>
          </svg>
          <input
            type="text"
            name="query"
            placeholder="Search..."
            class="w-full bg-gray-100/80 rounded-lg px-4 py-0.5 pl-10 pr-10 text-[15px] placeholder-gray-500 focus:outline-none focus:bg-gray-100 transition-colors border-0"
            value="<%= params[:query] %>"
            id="search-input"
          >
          <% if params[:query].present? %>
            <%= link_to restaurants_path, class: 'absolute right-3.5 w-5 h-5 flex items-center justify-center rounded-full bg-gray-400 hover:bg-gray-500 transition z-10', method: :get do %>
              <svg width="10px" height="10px" stroke-width="3" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-white">
                <path d="M6.75827 17.2426L12.0009 12M17.2435 6.75736L12.0009 12M12.0009 12L6.75827 6.75736M12.0009 12L17.2435 17.2426" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path>
              </svg>
            <% end %>
          <% end %>
        </div>
      <% end %>
    <% end %>



    <div class="gap-2 my-4 overflow-x-auto w-full grid grid-flow-col auto-cols-max hide-scrollbar">
      <% categories = [] %>
      <% @restaurants.each do |restaurant| %>
        <% unless categories.include?(restaurant.category) %>
          <% categories << restaurant.category %>
          <a href="#<%= restaurant.category.parameterize %>" class="w-fit h-fit flex items-center justify-center py-1.5 px-3 bg-white text-gray-700 hover:bg-gray-200 rounded-full transition duration-200 ease-in-out text-[13px] font-medium">
              <%= restaurant.category %>
          </a>
        <% end %>
      <% end %>
    </div>

    <% if @restaurants.any? %>
        <% last_restaurant = @restaurants.last %>
        <%= link_to restaurant_path(last_restaurant), class: "flex items-center gap-3 p-3 rounded-xl bg-white hover:bg-gray-200 transition-colors" do %>
          <div class="relative w-12 h-12 rounded-lg overflow-hidden flex-shrink-0">
            <% if last_restaurant.image_url.present? %>
              <%= image_tag last_restaurant.image_url, class: "w-full h-full object-cover" %>
            <% else %>
              <div class="w-full h-full bg-gradient-to-br from-gray-300 to-gray-200"></div>
            <% end %>
          </div>
          <div class="flex-1 min-w-0">
            <p class="text-[11px] text-gray-500 font-medium mb-0.5">LAST ADDED</p>
            <p class="text-[14px] font-semibold text-gray-900 truncate"><%= last_restaurant.name %></p>
          </div>
          <svg xmlns="http://www.w3.org/2000/svg" width="16px" height="16px" fill="none" stroke-width="2" viewBox="0 0 24 24" class="text-gray-400">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" d="M9 6l6 6-6 6"></path>
          </svg>
        <% end %>
    <% end %>

    <!-- Your content -->
    <% if @restaurants.present? %>
      <% @restaurants.group_by(&:category).each do |category, restaurants| %>
        <div id="<%= category.parameterize %>" class="flex items-center justify-between mt-6 mb-1">
          <p class="text-[--color--text--primary] font-medium">
            <%= category %>
          </p>
        </div>
        <!-- Grid colonnes qui scroll horizontalement ensemble style Apple Podcasts - max 3 restaurants par colonne -->
        <div class="overflow-x-auto -mx-4 sm:-mx-6 lg:-mx-8 px-4 sm:px-6 lg:px-8 mb-6">
          <div class="flex gap-3 hide-scrollbar" style="scroll-snap-type: x mandatory;">
            <% restaurants.each_slice(3).each do |column_restaurants| %>
              <div class="flex flex-col flex-shrink-0 w-[85vw] sm:w-[75vw] lg:w-[60vw] gap-3" style="scroll-snap-align: start;">
                <% column_restaurants.each do |restaurant| %>
                  <%= render 'restaurants/restaurant_card', restaurant: restaurant %>
                        <% end %>
                        </div>
            <% end %>
          </div>
        </div>
      <% end %>
      <% else %>
      <p class="text-[--color--text--primary] text-center">Aucun restaurant dans ma liste !</p>
      <%= link_to new_restaurant_path, class: "text-center text-gray-400 hover:text-white hover:bg-gray-800 group flex justify-center rounded-md p-2 text-sm leading-6 font-semibold" do %>
        <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="none" stroke-width="1" viewBox="0 0 24 24" color="currentColor">
          <path stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" d="M6 12h6m6 0h-6m0 0V6m0 6v6"></path>
        </svg>
        Ajouter mon premier restaurant
      <% end %>
    <% end %>

    <!-- Afficher les restaurants sans catégorie -->
    <% ungrouped_restaurants = @restaurants.select { |restaurant| restaurant.category.blank? } %>
    <% if ungrouped_restaurants.any? %>
        <div id="uncategorized" class="flex items-center justify-between mt-6 mb-1">
            <p class="text-[--color--text--primary]">
                Uncategorized
            </p>
            <p class="font-light py-1 px-3 bg-white/30 w-fit rounded-full text-[--color--red]">
                <%= ungrouped_restaurants.count %>
            </p>
        </div>
        <ul role="list" class="flex gap-4 overflow-x-auto w-full mb-8">
            <% ungrouped_restaurants.each do |restaurant| %>
                <li>
                <!-- Code pour afficher chaque restaurant sans catégorie -->
                </li>
            <% end %>
        </ul>
    <% end %>

  </div>
</main>
