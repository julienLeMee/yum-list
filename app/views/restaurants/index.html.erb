<main class="pt-16 pb-28 lg:pl-72">
  <div class="px-4 sm:px-6 lg:px-8">

    <div class="sm:mx-auto sm:w-full sm:max-w-sm">
        <h2 class="mt-2 text-xl font-semibold leading-9 tracking-tight text-[#333]"><%= pluralize(@restaurants.count, "restaurant") %> in your list</h2>
    </div>

    <div class="gap-2 my-4 overflow-x-auto w-full grid grid-flow-col auto-cols-max hide-scrollbar">
      <% categories = [] %>
      <% @restaurants.each do |restaurant| %>
        <% unless categories.include?(restaurant.category) %>
          <% categories << restaurant.category %>
          <a href="#<%= restaurant.category.parameterize %>" class="w-fit h-fit flex items-center justify-center py-1.5 px-3 bg-white text-gray-700 hover:bg-gray-200 rounded-full transition duration-200 ease-in-out text-[13px] font-medium">
              <%= restaurant.category %>
          </a>
        <% end %>
      <% end %>
    </div>

    <% if @restaurants.any? && @last_added_restaurant.present? %>
        <%= link_to restaurant_path(@last_added_restaurant), class: "flex items-center gap-3 p-3 rounded-xl bg-white hover:bg-gray-200 transition-colors" do %>
          <div class="relative w-12 h-12 rounded-lg overflow-hidden flex-shrink-0">
            <% if @last_added_restaurant.image_url.present? %>
              <%= image_tag @last_added_restaurant.image_url, class: "w-full h-full object-cover" %>
            <% else %>
              <div class="w-full h-full bg-gradient-to-br from-gray-300 to-gray-200"></div>
            <% end %>
          </div>
          <div class="flex-1 min-w-0">
            <p class="text-[11px] text-gray-500 font-medium mb-0.5">DERNIER AJOUTÉ</p>
            <p class="text-[14px] font-semibold text-gray-900 truncate"><%= @last_added_restaurant.name %></p>
          </div>
          <svg xmlns="http://www.w3.org/2000/svg" width="16px" height="16px" fill="none" stroke-width="2" viewBox="0 0 24 24" class="text-gray-400">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" d="M9 6l6 6-6 6"></path>
          </svg>
        <% end %>
    <% end %>

    <!-- Your content -->
    <% if @restaurants.present? %>
      <% @restaurants.group_by(&:category).each do |category, restaurants| %>
        <div id="<%= category.parameterize %>" class="flex items-center justify-between mt-8 mb-2">
          <p class="text-[--color--text--primary] font-bold">
            <%= category %>
          </p>
        </div>
        <!-- Grid colonnes qui scroll horizontalement ensemble style Apple Podcasts - max 3 restaurants par colonne -->
        <div class="overflow-x-auto -mx-4 sm:-mx-6 lg:-mx-8 px-4 sm:px-6 lg:px-8 mb-6">
          <div class="flex gap-3 hide-scrollbar" style="scroll-snap-type: x mandatory;">
            <% restaurants.each_slice(3).each do |column_restaurants| %>
              <div class="flex flex-col flex-shrink-0 w-[85vw] sm:w-[75vw] lg:w-[60vw] gap-3" style="scroll-snap-align: start;">
                <% column_restaurants.each do |restaurant| %>
                  <%= render 'restaurants/restaurant_card', restaurant: restaurant %>
                        <% end %>
                        </div>
            <% end %>
          </div>
        </div>
      <% end %>
      <% else %>
      <p class="text-[--color--text--primary] text-center">Aucun restaurant dans ma liste !</p>
      <%= link_to new_restaurant_path, class: "text-center text-gray-400 hover:text-white hover:bg-gray-800 group flex justify-center rounded-md p-2 text-sm leading-6 font-semibold" do %>
        <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="none" stroke-width="1" viewBox="0 0 24 24" color="currentColor">
          <path stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" d="M6 12h6m6 0h-6m0 0V6m0 6v6"></path>
        </svg>
        Ajouter mon premier restaurant
      <% end %>
    <% end %>

    <!-- Afficher les restaurants sans catégorie -->
    <% ungrouped_restaurants = @restaurants.select { |restaurant| restaurant.category.blank? } %>
    <% if ungrouped_restaurants.any? %>
        <div id="uncategorized" class="flex items-center justify-between mt-6 mb-1">
            <p class="text-[--color--text--primary]">
                Uncategorized
            </p>
            <p class="font-light py-1 px-3 bg-white/30 w-fit rounded-full text-[--color--red]">
                <%= ungrouped_restaurants.count %>
            </p>
        </div>
        <ul role="list" class="flex gap-4 overflow-x-auto w-full mb-8">
            <% ungrouped_restaurants.each do |restaurant| %>
                <li>
                <!-- Code pour afficher chaque restaurant sans catégorie -->
                </li>
            <% end %>
        </ul>
    <% end %>

  </div>
</main>
